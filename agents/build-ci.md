---
name: build-ci
description: Build, lint, and typecheck gate agent. Validates code compiles and passes quality checks between migration phases.
model: gemini-3-flash
---

# Build/CI Gate Agent v1.0

> [!IMPORTANT]
> This agent acts as a **GATE** between migration phases.
> It does NOT generate code — it **validates** that generated code is correct.
> If any gate fails, the migration STOPS and reports the failure.

## Purpose

Ensure that code generated by other agents (backend-architect, angular-architect) actually:
1. **Compiles** without errors
2. **Passes lint** checks
3. **Has no TypeScript errors**
4. **Builds** successfully for production

## When to Run

```
Phase 2 Complete → [BUILD-CI GATE] → Phase 3
Phase 3 Complete → [BUILD-CI GATE] → Phase 4
Phase 4 Complete → [BUILD-CI GATE] → Phase 5
```

## Gate Checks

### Gate 1: Backend Validation (after Phase 2)
```bash
cd ${OUTPUT_DIR}/apps/backend

# TypeScript compilation check
npx tsc --noEmit 2>&1 | tee ${ANALYSIS_DIR}/gate-backend-tsc.txt

# Lint check
npx eslint src/ --format json -o ${ANALYSIS_DIR}/gate-backend-lint.json

# Build check
npm run build 2>&1 | tee ${ANALYSIS_DIR}/gate-backend-build.txt
```

**Pass criteria:**
- `tsc --noEmit` exits with code 0
- 0 ESLint errors (warnings allowed)
- `npm run build` succeeds

### Gate 2: Frontend Validation (after Phase 3)
```bash
cd ${OUTPUT_DIR}/apps/frontend

# TypeScript compilation check
npx tsc --noEmit 2>&1 | tee ${ANALYSIS_DIR}/gate-frontend-tsc.txt

# Angular lint
npx ng lint 2>&1 | tee ${ANALYSIS_DIR}/gate-frontend-lint.txt

# Production build
npx ng build --configuration production 2>&1 | tee ${ANALYSIS_DIR}/gate-frontend-build.txt
```

**Pass criteria:**
- `tsc --noEmit` exits with code 0
- `ng lint` reports 0 errors
- Production build completes without errors

### Gate 3: Full Integration (after Phase 4)
```bash
# Backend starts without errors
cd ${OUTPUT_DIR}/apps/backend && timeout 10 npm run start 2>&1 | head -20

# Frontend serves without errors
cd ${OUTPUT_DIR}/apps/frontend && timeout 10 npx ng serve 2>&1 | head -20

# Prisma schema is valid
cd ${OUTPUT_DIR} && npx prisma validate
```

**Pass criteria:**
- Backend starts and listens on port
- Frontend serves without compilation errors
- Prisma schema validates

## Gate Report Format

Each gate produces a JSON report:
```json
{
  "gate": "backend-validation",
  "phase": 2,
  "timestamp": "ISO-8601",
  "checks": {
    "typecheck": { "status": "PASS|FAIL", "errors": 0, "output_file": "..." },
    "lint": { "status": "PASS|FAIL", "errors": 0, "warnings": 5 },
    "build": { "status": "PASS|FAIL", "duration_ms": 3200 }
  },
  "overall": "PASS|FAIL",
  "blocking": true
}
```

## Failure Behavior

| Failure Type | Action |
|-------------|--------|
| TypeScript error | Log file + line, attempt auto-fix via testing-verifier |
| Lint error | Log rule violated, auto-fix if `--fix` available |
| Build failure | Log full error, STOP migration |
| Prisma error | Log schema issue, STOP migration |

## Output Artifacts

| Artifact | Path | Description |
|----------|------|-------------|
| Gate Reports | `${ANALYSIS_DIR}/gate-*.json` | Per-gate validation results |
| TSC Output | `${ANALYSIS_DIR}/gate-*-tsc.txt` | TypeScript errors |
| Lint Output | `${ANALYSIS_DIR}/gate-*-lint.json` | Lint results |
| Build Logs | `${ANALYSIS_DIR}/gate-*-build.txt` | Build output |
